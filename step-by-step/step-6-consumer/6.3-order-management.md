# Step 6.3: Order Management

> **Prerequisites**: Complete Step 6.1 (Consumer Account) and Step 6.2 (Booking Flow)
> **Estimated Time**: 45 minutes
> **Skill Level**: Beginner (No coding required)

## What You'll Build

A comprehensive order management system where consumers can:
- View all their bookings (upcoming, active, past)
- Track service status in real-time
- Cancel or reschedule bookings
- View detailed order information
- Access booking history and receipts

This creates the complete consumer experience for managing their drone service bookings.

## Ask Yourself These Questions First

Before starting, think through these design decisions:

1. **Information Hierarchy**: What's most important for users to see first?
   - Should upcoming services be more prominent than past ones?
   - How much detail should show in the list vs detail view?

2. **Status Communication**: How will you show different booking states?
   - What visual indicators will you use (colors, icons, badges)?
   - How will you handle edge cases like cancelled or failed services?

3. **Quick Actions**: What actions should be one-click accessible?
   - Should cancel/reschedule be available from the list?
   - How will you prevent accidental cancellations?

4. **Mobile Experience**: How will this work on phones?
   - Will you use tabs, segments, or a different pattern?
   - How will you handle the limited screen space?

## Component Structure

```
OrderManagement/
‚îú‚îÄ‚îÄ OrderTabs                    # Tab navigation
‚îú‚îÄ‚îÄ UpcomingOrders/             # Active bookings
‚îÇ   ‚îú‚îÄ‚îÄ OrderCard               # Individual order display
‚îÇ   ‚îú‚îÄ‚îÄ StatusBadge            # Visual status indicator
‚îÇ   ‚îî‚îÄ‚îÄ QuickActions           # Cancel/Reschedule buttons
‚îú‚îÄ‚îÄ ActiveOrders/               # In-progress services
‚îÇ   ‚îú‚îÄ‚îÄ LiveTracking           # Real-time status
‚îÇ   ‚îî‚îÄ‚îÄ ContactOperator        # Communication options
‚îú‚îÄ‚îÄ PastOrders/                 # Completed bookings
‚îÇ   ‚îú‚îÄ‚îÄ OrderHistory           # List of past services
‚îÇ   ‚îî‚îÄ‚îÄ ReceiptDownload       # Invoice access
‚îî‚îÄ‚îÄ OrderDetails/               # Full order information
    ‚îú‚îÄ‚îÄ ServiceInfo            # What was booked
    ‚îú‚îÄ‚îÄ OperatorInfo          # Who's providing service
    ‚îú‚îÄ‚îÄ PaymentInfo           # Transaction details
    ‚îî‚îÄ‚îÄ ActionButtons         # Available actions
```

## Step-by-Step Instructions

### Part 1: Create the Main Orders Page

Create a tabbed interface for different order states:

**Prompt for Lovable:**
```
Create an order management page at /orders with three tabs:
- Upcoming (default): Services scheduled for the future
- Active: Services currently in progress
- Past: Completed and cancelled services

Use these exact styles:
- Tabs with #BD1B04 accent color for active tab
- Tab indicator underline in #BD1B04
- Hover state #9D1503 for inactive tabs
- Inter font (Bold for tab labels)

Header should import SharedHeader from Step 3.1
Include a page title "My Orders" below the header

Each tab panel should have padding and scroll independently
Show a count badge next to each tab label (e.g., "Upcoming (3)")
```

### Part 2: Design the Order Card Component

Create a reusable card for displaying order information:

**Prompt for Lovable:**
```
Create an OrderCard component that displays:

Header section:
- Service type icon and name (e.g., "üçï Food Delivery")
- Status badge (color-coded based on status)
- Order reference number (#SKY-2025-0123)

Body section:
- Date and time of service
- Pickup location (if delivery)
- Delivery/service location
- Operator name with avatar
- Price

Footer section:
- Action buttons based on status:
  - Upcoming: "View Details", "Reschedule", "Cancel"
  - Active: "Track Service", "Contact Operator"
  - Past: "View Details", "Book Again", "Download Receipt"

Status colors:
- Scheduled: #22C55E (green)
- In Progress: #3B82F6 (blue)
- Completed: #6B7280 (gray)
- Cancelled: #EF4444 (red)

Use card with white background, subtle shadow, and rounded corners
```

### Part 3: Implement the Upcoming Orders Tab

Display bookings scheduled for the future:

**Prompt for Lovable:**
```
Create the Upcoming Orders tab content:

If no upcoming orders:
- Show empty state with illustration
- Message: "No upcoming services"
- Subtext: "Your future bookings will appear here"
- Primary button: "Browse Services" linking to marketplace

With orders:
- Sort by date/time (soonest first)
- Group by date with headers (Today, Tomorrow, This Week, Later)
- Use OrderCard component for each booking
- Add subtle animation when cards load (fade in from top)

Include sample data:
1. Food delivery tomorrow at 12:30 PM
2. Aerial photography this Saturday at 2:00 PM
3. Package delivery next Monday at 9:00 AM

Quick actions should show confirmation dialogs:
- Cancel: "Are you sure you want to cancel this booking?"
- Reschedule: Open date/time picker modal
```

### Part 4: Build the Active Orders Section

Show services currently in progress:

**Prompt for Lovable:**
```
Create the Active Orders tab with real-time tracking:

Live status card:
- Large status indicator (pulsing dot animation)
- Current status text (e.g., "Operator en route to pickup")
- Estimated time remaining
- Progress bar showing service stages

Service stages for delivery:
1. Order Confirmed
2. Operator Assigned
3. Heading to Pickup
4. Package Collected
5. In Transit
6. Delivered

Include:
- Operator info card with photo, name, rating
- Contact button (opens communication modal)
- Live map preview (placeholder for now)
- Service details expansion panel

Add notification banner:
"You'll receive updates as your service progresses"

Use #3B82F6 (blue) for active status elements
Add subtle animations for progress updates
```

### Part 5: Create the Order History View

Display completed and cancelled bookings:

**Prompt for Lovable:**
```
Create the Past Orders tab with filterable history:

Filter options:
- Date range selector (Last 30 days, Last 3 months, All time)
- Status filter (Completed, Cancelled)
- Service type filter (checkboxes for each type)

Order display:
- Use more compact OrderCard variant
- Gray out cancelled orders slightly
- Show completion date and final price
- Include operator rating (if completed)

Add "Book Again" functionality:
- One-click rebooking with same details
- Pre-fills booking form with previous selections
- Shows toast: "Booking details loaded - please select new date"

Download receipt:
- PDF icon button
- Generate receipt with:
  - SkyMarket logo
  - Order details
  - Service information
  - Payment breakdown
  - Transaction ID

Include pagination or infinite scroll for long lists
```

### Part 6: Build the Order Details Modal

Create a comprehensive view of individual orders:

**Prompt for Lovable:**
```
Create an OrderDetails modal that opens when clicking "View Details":

Modal structure (full height on mobile, centered on desktop):

Header:
- Close button
- Order #SKY-2025-0123
- Status badge

Content sections:

1. Service Information:
   - Service type with icon
   - Date and time
   - Duration estimate
   - Special requirements

2. Location Details:
   - Service address (with map preview)
   - Pickup address (if applicable)
   - Distance (for deliveries)

3. Operator Information:
   - Profile card with photo
   - Name and company
   - Rating and completed services
   - Certifications/badges
   - "View Profile" link

4. Pricing Breakdown:
   - Base service fee
   - Distance/time charges
   - Platform fee
   - Total amount
   - Payment method used

5. Timeline (for completed orders):
   - Order placed: timestamp
   - Operator assigned: timestamp
   - Service started: timestamp
   - Service completed: timestamp

Action buttons (based on status):
- Upcoming: Cancel Booking, Reschedule, Contact Support
- Active: Track Service, Contact Operator
- Completed: Book Again, Download Receipt, Leave Review
- Cancelled: Book Again, Contact Support

Use proper spacing and dividers between sections
```

### Part 7: Add Cancellation Flow

Implement a user-friendly cancellation process:

**Prompt for Lovable:**
```
Create a cancellation flow with confirmation:

When user clicks "Cancel Booking":

Step 1 - Confirmation Modal:
- Title: "Cancel Booking?"
- Show booking details being cancelled
- Cancellation policy notice:
  "Free cancellation up to 2 hours before service.
   Cancellations within 2 hours may incur a fee."
- Reason selection (optional):
  - Plans changed
  - Found alternative service
  - No longer needed
  - Other (with text input)

Step 2 - Processing:
- Show loading state: "Cancelling your booking..."
- Update order status to "Cancelled"
- Show success message

Step 3 - Confirmation:
- Success icon (animated checkmark)
- "Booking Cancelled"
- "Refund will be processed within 3-5 business days"
- Show cancelled order with strikethrough
- Button: "Browse Other Services"

Send email notification (mock):
- Subject: "Booking Cancelled - Order #SKY-2025-0123"
- Include cancellation details and refund info
```

### Part 8: Implement Rescheduling Feature

Allow users to change booking dates/times:

**Prompt for Lovable:**
```
Create a reschedule flow:

When user clicks "Reschedule":

Step 1 - Date/Time Selection:
- Modal title: "Reschedule Service"
- Show current booking date/time
- Calendar picker (same as booking flow)
- Time slot grid showing availability
- Highlight unavailable slots
- Show price if different from original

Step 2 - Confirmation:
- Show comparison:
  Original: [date/time]
  New: [date/time]
- Any price difference highlighted
- Reschedule policy notice
- Confirm button: "Update Booking"

Step 3 - Success:
- Update order card with new date/time
- Show success toast: "Booking rescheduled successfully"
- Send confirmation email (mock)

Restrictions:
- Cannot reschedule within 2 hours of service
- Cannot reschedule to past dates
- Show operator availability dynamically
```

### Part 9: Add Quick Filters and Search

Make it easy to find specific orders:

**Prompt for Lovable:**
```
Add search and filter capabilities to the orders page:

Search bar (above tabs):
- Placeholder: "Search by order number, service, or operator"
- Search icon on left
- Clear button when text entered
- Searches across all tabs

Quick filters (below search):
- Pill buttons for common filters:
  - "This Week"
  - "Food Delivery"
  - "Aerial Services"
  - "High Priority"
- Selected pills show #BD1B04 background
- Multiple selections allowed (AND logic)

Sort options (dropdown):
- Date (Newest First) - default
- Date (Oldest First)
- Price (High to Low)
- Price (Low to High)
- Status

Results:
- Show count: "Showing 12 orders"
- Highlight matching text in search
- Maintain filter state when switching tabs
- Clear all filters button
```

### Part 10: Create Order Notifications

Add in-app notification system for order updates:

**Prompt for Lovable:**
```
Create an order notification system:

Notification types:
1. Booking Confirmed - green accent
2. Operator Assigned - blue accent
3. Service Started - blue accent
4. Service Completed - green accent
5. Booking Cancelled - red accent
6. Reminder (1 hour before) - yellow accent

Notification component:
- Slides in from top (desktop) or bottom (mobile)
- Icon based on type
- Title and message
- Timestamp
- Action button (View Order)
- Close button
- Auto-dismiss after 5 seconds

Notification center (bell icon in header):
- Badge with unread count
- Dropdown panel with recent notifications
- Group by date
- Mark as read functionality
- Clear all button

Store notifications in Supabase:
- user_id
- order_id
- type
- title
- message
- read_status
- created_at

Real-time updates using Supabase subscriptions
```

### Part 11: Mobile Optimizations

Ensure perfect mobile experience:

**Prompt for Lovable:**
```
Optimize the orders page for mobile devices:

Layout adjustments:
- Stack tabs horizontally with scroll if needed
- Reduce card padding on mobile
- Single column layout
- Sticky header with tabs

Order cards - mobile variant:
- Smaller fonts but maintain readability
- Stack information vertically
- Move action buttons to dropdown menu (three dots)
- Swipe gestures:
  - Swipe left: Show quick actions
  - Swipe right: Mark as favorite

Active orders:
- Full-screen tracking view
- Larger status text and progress indicators
- Fixed bottom bar with contact operator button

Order details:
- Full screen modal with native feel
- Sections in accordion format
- Sticky action buttons at bottom
- Pull down to close gesture

Touch optimizations:
- 44px minimum touch targets
- Increased spacing between interactive elements
- Haptic feedback for actions (where supported)
```

### Part 12: Add Export and Reporting

Let users download their booking data:

**Prompt for Lovable:**
```
Add data export functionality:

Export button (in account settings or orders page):
- Label: "Export Order History"
- Icon: Download symbol

Export options modal:
- Date range selection
- Format selection:
  - PDF (formatted report)
  - CSV (spreadsheet data)
  - JSON (raw data)
- Include options:
  - [ ] Completed orders
  - [ ] Cancelled orders
  - [ ] Payment details
  - [ ] Operator information

PDF report format:
- SkyMarket header with logo
- User information
- Summary statistics:
  - Total orders
  - Total spent
  - Most used services
- Detailed order list with all information
- Generated timestamp

CSV format:
- Headers: Order ID, Date, Service, Operator, Status, Amount
- One row per order
- Compatible with Excel/Google Sheets

Email delivery:
- "Your order history is ready"
- Download link (expires in 24 hours)
```

## Testing Your Order Management

### Functionality Checklist:
- [ ] All three tabs load and display correctly
- [ ] Order cards show appropriate information
- [ ] Status badges use correct colors
- [ ] Quick actions work (cancel, reschedule)
- [ ] Order details modal opens and closes properly
- [ ] Search filters orders correctly
- [ ] Sorting changes order sequence
- [ ] Pagination/scroll works for long lists

### User Experience Testing:
- [ ] Can users quickly find specific orders?
- [ ] Is the status of each order immediately clear?
- [ ] Are dangerous actions (cancel) properly confirmed?
- [ ] Does rescheduling feel intuitive?
- [ ] Can users easily contact operators when needed?

### Mobile Testing:
- [ ] Tabs are accessible on small screens
- [ ] Cards are readable without horizontal scroll
- [ ] Touch targets are large enough
- [ ] Modals work well on mobile
- [ ] Swipe gestures feel natural

## Common Gotchas and Solutions

### Problem: Too Many Orders Overwhelming
**Solution**: Implement smart defaults (show last 30 days), progressive loading, and clear filtering

### Problem: Status Confusion
**Solution**: Use consistent colors, clear labels, and status descriptions

### Problem: Accidental Cancellations
**Solution**: Always require confirmation, show consequences, allow undo (within time limit)

### Problem: Lost Orders
**Solution**: Robust search, multiple access points (email links, order number search)

## Enhancements for Operators (Preview)

Operators will have a mirrored system showing:
- Incoming booking requests
- Accepted bookings calendar
- Service completion workflow
- Payment tracking
- Customer communication

This creates the two-sided marketplace experience where both consumers and operators can manage their interactions efficiently.

## Final Checklist

Before moving on, ensure you have:

- [ ] Created tabbed interface for order states
- [ ] Built reusable OrderCard component
- [ ] Implemented upcoming orders with groups
- [ ] Added active order tracking
- [ ] Created order history with filters
- [ ] Built comprehensive order details view
- [ ] Implemented cancellation flow
- [ ] Added rescheduling capability
- [ ] Created search and filter system
- [ ] Optimized for mobile devices
- [ ] Tested all user journeys
- [ ] Verified Supabase integration points

## What's Next?

Congratulations! You've completed the consumer side of the marketplace. The full consumer experience includes:
- Account creation and profile management
- Browsing and searching for services
- Detailed booking flow
- Complete order management

Next steps would include:
- Step 7: Operator features (if building two-sided marketplace)
- Payment integration with Stripe
- Real-time tracking with maps
- Review and rating system
- Advanced notification system

Remember: You've built a sophisticated order management system without writing any code! This demonstrates the power of no-code platforms for rapidly prototyping complex applications.