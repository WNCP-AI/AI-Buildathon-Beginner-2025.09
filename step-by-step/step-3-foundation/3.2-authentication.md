# 3.2 Authentication: Building Your User Access System

**‚è±Ô∏è Time to Complete:** 30-40 minutes
**üí∞ Estimated Cost:** Free (using existing Lovable project)
**üéØ Difficulty:** Beginner (Copy-paste prompts)
**üìã What You'll Learn:** User authentication flows, role-based access, form validation, component reuse

---

## Overview: Securing Your Marketplace

### What You're Building
A complete authentication system with role selection, signup forms for both Consumers and Operators, and a login page. All pages will reuse the SharedHeader component from Step 3.1!

### Why This Step Matters
- **Security Foundation:** Every marketplace needs user accounts
- **Role Differentiation:** Consumers and Operators have different experiences
- **Component Reuse:** You'll import and use the SharedHeader from the landing page
- **Professional Patterns:** Learn how real apps handle authentication

### The Magic of Lovable + Supabase
Lovable automatically integrates with Supabase for authentication. When you create auth components, Lovable:
- Sets up the database tables
- Configures security rules
- Handles password encryption
- Manages user sessions

### üìù Ask Yourself Before Starting:
- Did I complete Step 3.1 (Landing Page)?
- Can I see the SharedHeader component in my project?
- Is my Lovable project still open?

**‚úÖ Pre-Check Complete:** I'm ready to add authentication

---

## Part 1: Understanding the Authentication Flow

### The User Journey
1. **New User Path:**
   - Clicks "Get Started" on landing page
   - Sees Role Selection (Consumer or Operator)
   - Fills out appropriate signup form
   - Redirected to dashboard after success

2. **Returning User Path:**
   - Clicks "Sign In" on landing page
   - Enters email and password
   - Redirected to role-specific dashboard

### Components You'll Build
1. **Role Selection Page** (UI-101)
   - Two cards: Consumer vs Operator
   - Visual choice before signup

2. **Consumer Signup** (UI-102)
   - Name, email, password, phone
   - Terms acceptance

3. **Operator Signup** (UI-103)
   - Business name, email, password, phone
   - Service category selection
   - Terms acceptance

4. **Login Page** (UI-104)
   - Email and password
   - "Remember me" option
   - Forgot password link

### üìù Ask Yourself:
- Do I understand the difference between Consumer and Operator roles?
- Can I visualize the flow from landing page to dashboard?

**‚úÖ Flow Understanding Complete:** I know how users will navigate

---

## Part 2: The Complete Authentication Prompt

### Copy This Entire Prompt Into Lovable:

```
Based on the Style Guide and UI screens in my knowledge base, create a complete authentication system for SkyMarket with role selection, signup forms, and login page. Import and use the SharedHeader component from the landing page.

## Import SharedHeader Component
Import the existing SharedHeader component from the landing page and use it on all auth pages. This ensures consistent navigation across the entire app.

## 1. Role Selection Page (/auth/role-selection)

### Page Structure
- Import and use SharedHeader at top
- Container: max-w-4xl mx-auto px-5 md:px-20 py-16

### Main Content
- Heading: "Welcome to SkyMarket!" (Inter Bold 32px, text-center)
- Subheading: "How do you want to use our platform?" (Inter Regular 18px, text-gray-600, text-center, mt-4)

### Role Cards (2 cards side-by-side, stack on mobile)
Create two RoleCard components with hover effects:

**Consumer Card:**
- Icon: üë§ (text-5xl)
- Title: "I'm a Consumer" (Inter SemiBold 24px)
- Benefits list (Inter Regular 14px, text-gray-600):
  ‚Ä¢ Book drone services
  ‚Ä¢ Track deliveries
  ‚Ä¢ Browse operators
- Button: "Continue as Consumer" (bg-[#BD1B04] hover:bg-[#9D1503] text-white px-6 py-3 rounded-lg w-full mt-6)
- Card styling: bg-white rounded-xl p-8 shadow-[0_2px_8px_rgba(0,0,0,0.04)] hover:shadow-[0_4px_16px_rgba(0,0,0,0.08)] hover:scale-105 transition-all cursor-pointer

**Operator Card:**
- Icon: üöÅ (text-5xl)
- Title: "I'm an Operator" (Inter SemiBold 24px)
- Benefits list:
  ‚Ä¢ Offer my services
  ‚Ä¢ Manage bookings
  ‚Ä¢ Grow my business
- Button: "Continue as Operator" (same styling as Consumer)
- Same card styling with hover effects

### Footer Note
- Text: "You can always add another role later" (text-sm text-gray-500, text-center, mt-8)

### Navigation
- Consumer button ‚Üí /auth/signup-consumer
- Operator button ‚Üí /auth/signup-operator

## 2. Consumer Signup Page (/auth/signup-consumer)

### Page Structure
- Import and use SharedHeader
- Back arrow link to role selection (flex items-center text-gray-600 hover:text-gray-900 mb-4)
- Container: max-w-md mx-auto px-5 md:px-20 py-12

### Form Container
- Background: bg-white rounded-xl p-8 shadow-[0_2px_8px_rgba(0,0,0,0.04)]
- Heading: "Create Your Consumer Account" (Inter Bold 24px, text-center)

### Form Fields (all with min-height: 44px for accessibility)
1. **Name Field**
   - Label: "Full Name" (Inter SemiBold 14px)
   - Input: border border-gray-300 rounded-lg px-4 py-3 w-full focus:border-[#BD1B04] focus:outline-none
   - Required field

2. **Email Field**
   - Label: "Email Address"
   - Input type: email
   - Same styling as name field

3. **Password Field**
   - Label: "Password"
   - Input type: password
   - Show/hide toggle button (eye icon)
   - Helper text: "At least 8 characters" (text-xs text-gray-500)

4. **Phone Field**
   - Label: "Phone Number (Optional)"
   - Input type: tel
   - Placeholder: "(313) 555-0000"

5. **ZIP Code Field**
   - Label: "ZIP Code"
   - Input type: text
   - Placeholder: "48226"
   - Helper text: "For service availability"

### Terms Checkbox
- Checkbox with label: "I agree to the Terms of Service and Privacy Policy"
- Links styled with text-[#BD1B04] hover:text-[#9D1503]

### Submit Button
- Text: "Create Account"
- Styling: bg-[#BD1B04] hover:bg-[#9D1503] text-white px-6 py-3 rounded-lg w-full mt-6 font-semibold
- Disabled state when form invalid

### Footer Link
- Text: "Already have an account? Sign in"
- "Sign in" link to /auth/login with text-[#BD1B04]

## 3. Operator Signup Page (/auth/signup-operator)

### Same Structure as Consumer with Additional Fields:

### Business Information Section
1. **Business Name Field**
   - Label: "Business Name"
   - Required field

2. **Service Category Dropdown**
   - Label: "Primary Service Category"
   - Options:
     ‚Ä¢ Food Delivery
     ‚Ä¢ Courier/Parcel
     ‚Ä¢ Aerial Imaging
     ‚Ä¢ Site Mapping
   - Styling: Same as other inputs with dropdown arrow

3. **Service Area Field**
   - Label: "Service Area"
   - Placeholder: "e.g., Downtown Detroit, Metro Detroit"

4. **FAA License Field**
   - Label: "FAA License Number (if applicable)"
   - Optional field

### Everything else same as Consumer signup

## 4. Login Page (/auth/login)

### Page Structure
- Import and use SharedHeader
- Container: max-w-md mx-auto px-5 md:px-20 py-16

### Form Container
- Heading: "Welcome Back to SkyMarket" (Inter Bold 28px, text-center)
- Subheading: "Sign in to your account" (Inter Regular 16px, text-gray-600, text-center, mt-2)

### Form Fields
1. **Email Field**
   - Label: "Email Address"
   - Same input styling as signup

2. **Password Field**
   - Label: "Password"
   - Show/hide toggle
   - "Forgot your password?" link (text-sm text-[#BD1B04] hover:text-[#9D1503], aligned right)

### Remember Me Checkbox
- Checkbox with label: "Remember me"
- Left-aligned below password field

### Submit Button
- Text: "Sign In"
- Same button styling as signup forms

### Footer Links
- Centered text: "New to SkyMarket?"
- Link: "Create an Account" ‚Üí /auth/role-selection

## 5. Success States & Error Handling

### Success Redirects
- Consumer signup ‚Üí Consumer dashboard (placeholder page)
- Operator signup ‚Üí Operator dashboard (placeholder page)
- Login ‚Üí Check user role, redirect accordingly

### Error States
- Invalid email: "Please enter a valid email address"
- Weak password: "Password must be at least 8 characters"
- Existing account: "An account with this email already exists"
- Login failed: "Invalid email or password"
- Show errors below relevant fields in red (#EF4444)

### Loading States
- Buttons show spinner and "Creating account..." or "Signing in..." text
- Disable form during submission

## Mobile Responsive Design
- All forms stack vertically on mobile
- Role cards stack on screens < 768px
- Maintain 20px padding on mobile
- Ensure 44px minimum touch targets

## Supabase Integration Notes
Lovable will automatically:
- Create user accounts in Supabase Auth
- Store role in user metadata
- Handle password encryption
- Manage sessions and cookies
- Set up email verification (if configured)

Use Supabase Auth hooks for form handling. Store user role as metadata during signup.
```

### After Pasting the Prompt:
1. Press Enter and wait for Lovable to generate
2. Watch as multiple pages are created
3. Notice SharedHeader appears on all pages
4. Test the navigation flow between pages

### üìù Ask Yourself:
- Did I copy the entire prompt?
- Can I see Lovable creating multiple pages?
- Is the SharedHeader visible on the new pages?

**‚úÖ Prompt Complete:** I've pasted the authentication prompt into Lovable

---

## Part 3: Verifying Your Authentication System

### Visual Checklist - Role Selection Page:

**Header:**
- [ ] SharedHeader from landing page is present
- [ ] Same navigation and styling as landing page

**Role Cards:**
- [ ] Two cards side by side (desktop)
- [ ] Consumer card with üë§ icon
- [ ] Operator card with üöÅ icon
- [ ] Both cards have hover effects (lift and shadow)
- [ ] Red buttons (#BD1B04) on each card

### Visual Checklist - Signup Pages:

**Consumer Signup:**
- [ ] SharedHeader at top
- [ ] Back arrow to role selection
- [ ] Form fields: Name, Email, Password, Phone, ZIP
- [ ] Password show/hide toggle
- [ ] Terms checkbox
- [ ] Red "Create Account" button
- [ ] "Sign in" link at bottom

**Operator Signup:**
- [ ] All Consumer fields PLUS:
- [ ] Business Name field
- [ ] Service Category dropdown
- [ ] Service Area field
- [ ] FAA License field (optional)

### Visual Checklist - Login Page:

**Form Elements:**
- [ ] SharedHeader at top
- [ ] Email and Password fields
- [ ] Remember me checkbox
- [ ] Forgot password link
- [ ] Red "Sign In" button
- [ ] "Create an Account" link

### Navigation Flow Test:
1. **From Landing Page:**
   - Click "Get Started" ‚Üí Should see Role Selection
   - Click "Sign In" ‚Üí Should see Login page

2. **From Role Selection:**
   - Click Consumer card ‚Üí Consumer Signup
   - Click Operator card ‚Üí Operator Signup

3. **From Signup Pages:**
   - Click back arrow ‚Üí Role Selection
   - Click "Sign in" link ‚Üí Login page

4. **From Login:**
   - Click "Create an Account" ‚Üí Role Selection

### üìù Ask Yourself:
- Does SharedHeader appear on ALL auth pages?
- Can I navigate between all pages smoothly?
- Do all forms have the correct fields?
- Are the colors consistent (#BD1B04 for primary actions)?

**‚úÖ Visual Verification Complete:** My authentication system looks correct

---

## Part 4: Testing Form Interactions

### Test These Interactions:

**Password Show/Hide:**
1. Type a password
2. Click the eye icon
3. Password should toggle between dots and text

**Form Validation:**
1. Try submitting empty form
2. Should see required field errors
3. Enter invalid email format
4. Should see email validation error

**Hover Effects:**
1. Hover over role cards
2. Cards should lift with increased shadow
3. Hover over buttons
4. Buttons should darken to #9D1503

**Mobile Responsiveness:**
1. Make preview narrow
2. Role cards should stack
3. Form should be full width
4. Navigation should still work

### üìù Ask Yourself:
- Do all interactive elements respond to hover?
- Does form validation prevent invalid submissions?
- Does the layout adapt properly on mobile?

**‚úÖ Interaction Test Complete:** Forms are working correctly

---

## Common Problems & Solutions

### Problem: "SharedHeader is not appearing"
**Solution:**
```
Import the SharedHeader component from the landing page at the top of each auth page. Make sure the import path is correct and the component is exported from the landing page.
```

### Problem: "Role cards aren't side by side"
**Solution:**
```
Fix the role cards layout. Use flex flex-col md:flex-row gap-6 on the container. Each card should have flex-1 to take equal width on desktop.
```

### Problem: "Form validation isn't working"
**Solution:**
```
Add proper form validation:
1. Mark required fields with the required attribute
2. Use type="email" for email fields
3. Add pattern attribute for phone numbers
4. Show error messages below each field
```

### Problem: "Navigation between pages is broken"
**Solution:**
```
Fix the navigation links:
- Role Selection Consumer ‚Üí /auth/signup-consumer
- Role Selection Operator ‚Üí /auth/signup-operator
- Signup pages "Sign in" ‚Üí /auth/login
- Login "Create Account" ‚Üí /auth/role-selection
```

### Problem: "Supabase errors on signup"
**Solution:**
```
Check that Supabase is properly configured:
1. Ensure email/password auth is enabled in Supabase
2. Store user role in metadata during signup
3. Handle auth errors gracefully with try/catch
```

### Emergency Recovery:
If authentication is completely broken:
```
Start fresh with a simple login page:
1. Create a basic email/password form
2. Use Lovable's built-in Supabase auth
3. Don't worry about roles initially
4. Focus on getting basic login working first
```

### üìù Ask Yourself:
- Have I encountered any of these issues?
- Do I know how to apply fixes in Lovable?
- Is navigation working between all pages?

**‚úÖ Troubleshooting Complete:** I can handle common auth issues

---

## Final Verification Checklist

### ‚úÖ Complete Before Moving On:

**Component Reuse:**
- [ ] SharedHeader imported from landing page
- [ ] SharedHeader appears on all 4 auth pages
- [ ] Header styling matches landing page exactly

**Page Structure:**
- [ ] Role Selection page with 2 cards
- [ ] Consumer Signup with 5 fields
- [ ] Operator Signup with 9 fields
- [ ] Login page with email/password

**Visual Consistency:**
- [ ] Red accent color (#BD1B04) on all CTAs
- [ ] White backgrounds on forms
- [ ] Inter font family throughout
- [ ] Consistent spacing and padding

**Form Functionality:**
- [ ] All required fields marked
- [ ] Email validation working
- [ ] Password show/hide toggles
- [ ] Error messages display

**Navigation Flow:**
- [ ] Can navigate from landing to role selection
- [ ] Can reach appropriate signup from role cards
- [ ] Can switch between signup and login
- [ ] Back arrows work correctly

**Responsive Design:**
- [ ] Role cards stack on mobile
- [ ] Forms are full-width on mobile
- [ ] All text remains readable
- [ ] Touch targets are 44px minimum

### üìù Final Reflection:
- How did component reuse (SharedHeader) save time?
- What's the benefit of having separate Consumer/Operator flows?
- How does Lovable handle Supabase integration automatically?

**‚úÖ Authentication System Complete:** I've built a full auth system with role-based access!

---

## What's Coming Next

### In Step 4.1 (Consumer Dashboard):
You'll create the Consumer's home screen where they can:
- Browse available services
- View their recent orders
- Access their profile

The SharedHeader will automatically be there, maintaining consistency!

### In Step 4.2 (Operator Dashboard):
You'll build the Operator's control center for:
- Managing their services
- Viewing bookings
- Tracking earnings

### The Power of Your Foundation:
By completing Steps 3.1 and 3.2, you now have:
- A complete landing page
- Full authentication system
- Reusable SharedHeader component
- Role-based user flows
- Supabase backend integration

This foundation supports everything else you'll build!

### üìù Prepare for Next Step:
- Keep your Lovable project open
- Remember you have two user types (Consumer/Operator)
- Think about what each dashboard should show

**Next Step:** Continue to Step 4 to build the marketplace features!

---

**üéØ Pro Tips:**
- Test the complete flow from landing ‚Üí role selection ‚Üí signup ‚Üí dashboard
- Try creating actual accounts to see Supabase in action
- The SharedHeader will need updating when users are logged in (future step)
- Role-based redirects are crucial for good UX

**üí° Remember:** You've just built a production-ready authentication system! This same pattern is used by real marketplace apps. The combination of role selection, separate signup flows, and shared components creates a professional user experience.